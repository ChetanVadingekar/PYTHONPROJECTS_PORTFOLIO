import boto3
import json

dynamodb = boto3.client('dynamodb')
kendra = boto3.client('kendra')

def lambda_handler(event, context):
    # Fetch data from DynamoDB
    response = dynamodb.scan(
        TableName='YourDynamoDBTableName',
    )
    documents = response['Items']
    
    kendra_documents = []
    
    for doc in documents:
        # Prepare documents for Kendra ingestion
        kendra_document = {
            'Id': doc['id']['S'],  # Use a unique identifier
            'Title': doc['title']['S'],
            'Blob': doc['content']['S'].encode('utf-8'),  # Content of the document
            'Attributes': [
                {
                    'Key': 'Author',
                    'Value': {
                        'StringValue': doc['author']['S']
                    }
                },
                # Add other attributes if necessary
            ]
        }
        kendra_documents.append(kendra_document)
    
    # Batch upload to Kendra
    try:
        kendra.batch_put_document(
            IndexId='YourKendraIndexId',
            Documents=kendra_documents
        )
        return {
            'statusCode': 200,
            'body': json.dumps('Documents ingested into Kendra successfully')
        }
    except Exception as e:
        return {
            'statusCode': 500,
            'body': json.dumps(f'Failed to ingest documents: {str(e)}')
        }
